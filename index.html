<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Dashboard</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
.sidebar { width: 220px; background: #222; color: #fff; height: 100vh; position: fixed; padding: 20px; }
.sidebar h2 { margin-top: 0; font-size: 22px; text-align: center; }
.content { margin-left: 240px; padding: 20px; }
.card { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
input, select, button { width: 100%; padding: 10px; margin-top: 10px; margin-bottom: 10px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; }
.resultBox { position: absolute; background: #fff; border: 1px solid #ccc; border-radius: 6px; width: calc(100% - 22px); max-height: 200px; overflow-y: auto; display: none; z-index: 1000; }
.resultItem { padding: 8px; cursor: pointer; }
.resultItem:hover { background-color: #f0f0f0; }
.productList { width: 100%; border-collapse: collapse; margin-top: 10px; }
.productList th, .productList td { padding: 8px; border-bottom: 1px solid #ccc; text-align: left; }
.productList th { background: #f2f2f2; }
.available { color: green; font-weight: bold; }
.notAvailable { color: red; font-weight: bold; }
</style>
</head>
<body>

<div class="sidebar">
  <h2>Dashboard</h2>
  <p>• Product Search</p>
  <p>• Inventory Summary</p>
  <p>• Status</p>
</div>

<div class="content">
  <h1>Product Availability Dashboard</h1>

  <div class="card">
    <h3>Search Product</h3>
    <div style="position: relative;">
      <input type="text" id="search" placeholder="Type product name..." onkeyup="searchProduct()">
      <div id="resultBox" class="resultBox"></div>
    </div>

    <table class="productList" id="productTable">
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h3>Add New Product</h3>
    <input type="text" id="newProductName" placeholder="Product Name">
    <select id="newProductStatus">
      <option value="available">Available</option>
      <option value="notAvailable">Not Available</option>
    </select>
    <button id="addButton">Add Product</button>
  </div>

  <div class="card">
    <h3>Inventory Overview</h3>
    <p>Total products: <strong id="totalCount"></strong></p>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBtdJOHNsXDmnmhedb7V8wtKKWZWguHSbM",
    authDomain: "joy-database-1885a.firebaseapp.com",
    projectId: "joy-database-1885a",
    storageBucket: "joy-database-1885a.firebasestorage.app",
    messagingSenderId: "1099263263320",
    appId: "1:1099263263320:web:43d03d8f3aaf52c1d7c02d",
    measurementId: "G-J563DNJKPF"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let products = [];

// Fetch products from Firestore
async function fetchProducts() {
    products = [];
    try {
        const querySnapshot = await getDocs(collection(db, "product"));
        querySnapshot.forEach(doc => {
            const data = doc.data();
            if (data.product && data.status) {
                products.push({ name: data.product, status: data.status });
            }
        });
    } catch (e) {
        console.error(e);
    }
    document.getElementById("totalCount").textContent = products.length;
    populateProductTable(products);
}

function populateProductTable(list) {
    const tbody = document.getElementById("productTable").querySelector("tbody");
    tbody.innerHTML = "";
    list.forEach(product => {
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.textContent = product.name;
        const tdStatus = document.createElement("td");
        tdStatus.textContent = product.status === "available" ? "Available" : "Not Available";
        tdStatus.classList.add(product.status === "available" ? "available" : "notAvailable");
        tr.appendChild(tdName);
        tr.appendChild(tdStatus);
        tbody.appendChild(tr);
    });
}

// Live search pop-up with closest match on top
function searchProduct() {
    const input = document.getElementById("search").value.toLowerCase();
    const resultBox = document.getElementById("resultBox");
    resultBox.innerHTML = "";

    if (input === "") {
        resultBox.style.display = "none";
        populateProductTable(products);
        return;
    }

    let matches = products.filter(p => p.name.toLowerCase().includes(input));

    // Sort: names starting with input appear first
    matches.sort((a, b) => {
        const aName = a.name.toLowerCase();
        const bName = b.name.toLowerCase();
        const aStarts = aName.startsWith(input) ? 0 : 1;
        const bStarts = bName.startsWith(input) ? 0 : 1;
        return aStarts - bStarts;
    });

    if (matches.length > 0) {
        matches.forEach(match => {
            const div = document.createElement("div");
            div.className = "resultItem";
            div.textContent = `${match.name} (${match.status === "available" ? "Available" : "Not Available"})`;
            div.onclick = () => {
                document.getElementById("search").value = match.name;
                resultBox.style.display = "none";
                populateProductTable([match]);
            };
            resultBox.appendChild(div);
        });
        resultBox.style.display = "block";
    } else {
        const div = document.createElement("div");
        div.className = "resultItem";
        div.textContent = "No product found";
        resultBox.appendChild(div);
        resultBox.style.display = "block";
    }

    populateProductTable(matches);
}

// Add product
async function addProduct() {
    const name = document.getElementById("newProductName").value.trim();
    const status = document.getElementById("newProductStatus").value;
    if (!name) { alert("Enter a product name"); return; }
    try {
        await addDoc(collection(db, "product"), { product: name, status: status });
        document.getElementById("newProductName").value = "";
        document.getElementById("newProductStatus").value = "available";
        fetchProducts();
    } catch (e) { alert(e.message); }
}

document.getElementById("addButton").addEventListener("click", addProduct);
fetchProducts();
</script>

</body>
</html>
